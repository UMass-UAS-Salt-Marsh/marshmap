<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>UMass UAS Salt Marsh Project salt marsh land cover mapping • saltmarsh</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="UMass UAS Salt Marsh Project salt marsh land cover mapping">
<meta name="description" content="Predictive model of salt marsh land cover from drone-based imagery.">
<meta property="og:description" content="Predictive model of salt marsh land cover from drone-based imagery.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">saltmarsh</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UMass-UAS-Salt-Marsh/salt-marsh-mapping/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="salt-marsh-mapping">salt-marsh-mapping<a class="anchor" aria-label="anchor" href="#salt-marsh-mapping"></a>
</h1></div>
<p><a href="https://github.com/UMass-UAS-Salt-Marsh/salt-marsh-mapping/" class="external-link"><img src="reference/figures/hexsticker.png" align="right" height="150" style="float:right; height:150px;"></a></p>
<p>UMass UAS Salt Marsh Project salt marsh land cover mapping</p>
<p><code>salt-marsh-mapping</code> is a special-purpose package for the vegetation mapping component of the UMass UAS Salt Marsh project. This project uses UAS (Unoccupied Aerial Systems), a.k.a “drones,” with a number of sensors, along with field transects to drive vegetation cover models at several salt marshes in Massachusetts.</p>
<p>This package supports modeling for this project. It is intended to be run on the UMass Unity cluster using <a href="https://github.com/UMassCDS/slurmcollie" class="external-link">slurmcollie</a>, although all functions may be run locally if needed.</p>
<p>This documentation is a work in progress.</p>
<div class="section level2">
<h2 id="installation-and-set-up">Installation and set up<a class="anchor" aria-label="anchor" href="#installation-and-set-up"></a>
</h2>
<div class="section level3">
<h3 id="install-the-package-and-dependencies">Install the package and dependencies<a class="anchor" aria-label="anchor" href="#install-the-package-and-dependencies"></a>
</h3>
<pre><code><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'UMass-UAS-Salt-Marsh/salt-marsh-mapping'</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'UMassCDS/slurmcollie'</span><span class="op">)</span>                                    <span class="co"># a companion package required for running batch jobs on Unity</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'rspatial/terra'</span><span class="op">)</span>                                          <span class="co"># need this until 1.8-73 is released on CRAN</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'bwcompton/batchtools'</span>, ref <span class="op">=</span> <span class="st">'bwcompton-robust-sbatch'</span><span class="op">)</span>   <span class="co"># while waiting for pull request</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="authorize-google-drive">Authorize Google Drive<a class="anchor" aria-label="anchor" href="#authorize-google-drive"></a>
</h3>
<p>If you’ll be getting data from the Google Drive with <code>gather</code>, you’ll need get an authorization token. This needs to be done only once for each user. Run the following from the Unity account you’ll be using:</p>
<pre><code><span><span class="fu"><a href="reference/set_up_google_drive.html">set_up_google_drive</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="processing-sequence">Processing sequence<a class="anchor" aria-label="anchor" href="#processing-sequence"></a>
</h2>
<p>Here’s a brief summary of the processing sequence. See the help for each function for details. An example sequence will be created soon. All of these are normally launched as batch jobs on Unity via <code>slurmcollie</code> (except for <code>screen</code> which is intrinsically interactive and speedy <code>assess</code>).</p>
<ol style="list-style-type: decimal">
<li>
<code>gather</code> Gather the data from the source (either Google Drive or SFTP)</li>
<li>
<code>screen</code> build the flights database and open a web app to allow visually assigning quality scores to each image.</li>
<li>
<code>derive</code> Create derived images, such as NDVI (Normalized Difference Vegetation Index), upscaled images, and canopy height estimates from the difference between mid-summer and early spring DEMs.</li>
<li>
<code>sample</code> Sample images at points where we have field-collected data, creating a data table for modeling.</li>
<li>
<code>fit</code> Build statistical models of vegetation cover with random forests, AdaBoost (planned), or potentially other modeling frameworks and report model assessment.</li>
<li>
<code>map</code> Produce geoTIFF maps of predicted vegetation cover.</li>
</ol>
<div class="section level3">
<h3 id="additional-functions">Additional functions<a class="anchor" aria-label="anchor" href="#additional-functions"></a>
</h3>
<ul>
<li>
<code>fitinfo</code> Displays information from the fits database on one or more fits, including model specification, assessment, and run statistics such as CPU and memory use. Can also be used to save an Excel-friendly text version of the fits database and to set assessment scores and comments.</li>
<li>
<code>mapinfo</code> Displays information from the maps database, including model used for each map and run statistics such as CPU and memory use. Can also be used to Can also be used to save an Excel-friendly text version of the maps database and set map scores and comments.</li>
<li>
<code>assess</code> Provide a model assessment. This is normally included in <code>fit</code>, but <code>assess</code> may be called separately to assess the fit of a model built on one or more sites and applied to other sites.</li>
<li>
<code>flights_report</code> Creates a report on on orthoimages for all sites, including a summary for each site, a list of files flagged for repair in <code>screen</code>, a list of duplicated portable names for each site, and a list of all files for each site.</li>
<li>
<code>build_flights_db</code> Builds the flights database for a site, necessary after new files are downloaded with <code>gather</code>. This is normally called by <code>screen</code> when you first view a site, so there’s no need to call it manually unless you are unable or unwilling to run <code>screen</code>.</li>
<li>
<code>find_orthos(site, descrip)</code> Returns a data frame of file names and portable names matched by one or more file names, portable names, search names, or regular expressions of file names or portable names for a given site. You can use this to refine name designations and be sure you’re getting what you want.</li>
</ul>
</div>
<div class="section level3">
<h3 id="slurmcollie-functions">
<code>slurmcollie</code> functions<a class="anchor" aria-label="anchor" href="#slurmcollie-functions"></a>
</h3>
<p>See <a href="https://github.com/UMassCDS/slurmcollie" class="external-link">slurmcollie</a> for details.</p>
<ul>
<li>
<code>info()</code> Shows the status of jobs you’ve launched</li>
<li>
<code>showlog(job)</code> Shows the log of a running or finished job</li>
<li>
<code>kill(jobs)</code> Kill one or more jobs you didn’t mean to launch</li>
<li>
<code>purge(jobs)</code> Purge jobs that have finished or failed once you no longer care about them</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="image-naming">Image naming<a class="anchor" aria-label="anchor" href="#image-naming"></a>
</h2>
<p>UAS images (orthophotos, DEMs, canopy height models, and derived variables) may be referred to in three different ways. Functions that take imagery names as arguments (<code>gather</code>, <code>derive</code>, <code>sample</code>, and <code>fit</code>) use <code>find_orthos</code> to resolve all three of these name types, as well as regular expressions of file names and portable names. Use <code>find_orthos</code> to try out name designations.</p>
<div class="section level3">
<h3 id="file-name">File name<a class="anchor" aria-label="anchor" href="#file-name"></a>
</h3>
<p>This is the file name assigned during image processing. Filenames usually encode the image’s date, site, tide level, sensor, and type, for instance <code>19Aug22_OTH_Mid_SWIR_Ortho.tif</code> or <code>14Oct20_OTH_Low_Mica_DEM.tif</code>. File names are somewhat inconsistent, for instance, the month may be <code>Sep</code> or <code>Sept</code>, years may be 2 or 4 digits, and some sensors are referred to by multiple names. Additionally, some filenames follow a wildly different pattern, such as <code>OTH_Aug2022_CHM_NoThin_5cmTriNN_NAD83.tif</code>, a canopy height model. Files are imported from the source repositories (either Google Drive or SFTP) with their names unmodified.</p>
<p>When using <code>derive</code> to create derived images (for example, <code>NDVI</code> or <code>mean upscaling</code>), derived names are generated from the base name (or names), with derivation information separated with a double underscore, e.g., <code>x20Jun22_OTH_Mid_Mica_Ortho__NDVI.tif</code>. See <code>derive</code> for details.</p>
<p>These file names are unsuitable for use in modeling because they include the site code and the exact date of the flight, both of which would break any attempt to build a model on one or more sites and apply it to others. The name inconsistencies also make them difficult to use.</p>
</div>
<div class="section level3">
<h3 id="portable-name">Portable name<a class="anchor" aria-label="anchor" href="#portable-name"></a>
</h3>
<p>Portable names are generated by <code>build_flights_db</code> (which is called to update the flights database whenever you run <code>screen</code>, so if you’re visually screening all images in a normal process you won’t need to worry about this). Portable names exclude the site, use seasons instead of an exact date, and force naming consistency.</p>
<p>Portable names for most images consist of:</p>
<p><code>&lt;type&gt;_&lt;sensor&gt;_&lt;season&gt;_&lt;year&gt;_&lt;tide&gt;[.&lt;tidemod&gt;][_&lt;derive&gt;[.&lt;window&gt;]]</code></p>
<p>The portable names for canopy height models are simply:</p>
<p><code>chm_&lt;source&gt;_&lt;year&gt;</code>, where <code>source</code> is either <code>lidar</code> or <code>delta</code>.</p>
<p>Here are examples of file names and portable names</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>File name</th>
<th>Portable name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>19Aug22_OTH_Mid_SWIR_Ortho.tif</code></td>
<td><code>ortho_swir_summer_2022_mid</code></td>
</tr>
<tr class="even">
<td><code>14Oct20_OTH_Low_Mica_DEM.tif</code></td>
<td><code>dem_mica_fall_2020_low</code></td>
</tr>
<tr class="odd">
<td><code>OTH_Aug2022_CHM_NoThin_5cmTriNN_NAD83.tif</code></td>
<td><code>chm_summer_2022</code></td>
</tr>
<tr class="even">
<td><code>x20Jun22_OTH_Mid_Mica_Ortho__NDVI.tif</code></td>
<td><code>ndvi_mica_spring_2022_mid</code></td>
</tr>
<tr class="odd">
<td><code>x01Aug20_OTH_MidOut_Mica_Ortho.tif</code></td>
<td><code>ortho_mica_summer_2020_mid.out</code></td>
</tr>
<tr class="even">
<td><code>OTH_Aug2022_CHM_NoThin_5cmTriNN_NAD83.tif</code></td>
<td><code>chm_lidar_2022</code></td>
</tr>
<tr class="odd">
<td><code>x26May22_RR_Low_Mica_DEM__x19Aug22_RR_Low_Mica_DEM.tif</code></td>
<td><code>chm_delta_2022</code></td>
</tr>
</tbody>
</table>
<p>Portable names are used for variable names in data files created by <code>sample</code>, and they’re the names you’ll see in model assessments. You can find the portable name for each file in <code>data/&lt;site&gt;/flights/flights_&lt;site&gt;.txt</code>. The portable name is displayed in the <code>screen</code> app.</p>
<p>In cases where portable names refer to two or more image files (because two identical site/type/sensor/tide flights were flown in the same season), the image with the highest score will be used. Remaining ties will be broken by taking the earliest matching image.</p>
</div>
<div class="section level3">
<h3 id="search-name">Search name<a class="anchor" aria-label="anchor" href="#search-name"></a>
</h3>
<p>Finally, search names allow model fits to refer to multiple files in an easily-readable format. The components of a search name are separated with vertical bars (note these are pretty separators, NOT logical or–the parts of a search name are conjunctive). Multiple values of a component are separated with commas, or a colon to select a range for ordinal values such as season or year. Modifiers (in, out, and spring for tides; window size for upscaled variables) are separated from the component with a period, e.g., <code>mid.out</code>. Components in a search name may appear in any order. Each component in the search name narrows the search, thus <code>mica | low, mid</code> matches any files with a Mica sensor that are at low or mid-tide. Here are some example search names:</p>
<p><code>mid.in, mid.out, high</code><br><code>mica, swir, p4 | ortho | high.spring | spring:fall | 2019:2022</code><br><code>mica, swir | ortho, dem | low:high | spring | 2018</code></p>
<p>Search names allow model fits to be described clearly and concisely, even for models that contain dozens of variables, as they often will.</p>
<p>See <code><a href="reference/search_names.html">help(search_names)</a></code> for details.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/UMass-UAS-Salt-Marsh/salt-marsh-mapping/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/UMass-UAS-Salt-Marsh/salt-marsh-mapping/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3) + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing saltmarsh</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Bradley Compton <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0009-0002-2375-8116" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Compton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
