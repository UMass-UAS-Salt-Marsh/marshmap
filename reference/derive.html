<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create derived variables — derive • marshmap</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create derived variables — derive"><meta name="description" content="Crease derived variables such as NDVI and NDRE, upscaled images, and canopy height estimates."><meta property="og:description" content="Crease derived variables such as NDVI and NDRE, upscaled images, and canopy height estimates."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">marshmap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UMass-UAS-Salt-Marsh/marshmap/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create derived variables</h1>
      <small class="dont-index">Source: <a href="https://github.com/UMass-UAS-Salt-Marsh/marshmap/blob/main/R/derive.R" class="external-link"><code>R/derive.R</code></a></small>
      <div class="d-none name"><code>derive.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Crease derived variables such as NDVI and NDRE, upscaled images, and canopy height estimates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">derive</span><span class="op">(</span></span>
<span>  <span class="va">site</span>,</span>
<span>  pattern1 <span class="op">=</span> <span class="st">""</span>,</span>
<span>  pattern2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NDVI"</span>, <span class="st">"NDWIg"</span>, <span class="st">"NDRE"</span><span class="op">)</span>,</span>
<span>  window <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  cache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  resources <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  local <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comment <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-site">site<a class="anchor" aria-label="anchor" href="#arg-site"></a></dt>
<dd><p>One or more site names, using 3 letter abbreviation. Use <code>all</code> to process all sites.
In batch mode, each named site will be run in a separate job.</p></dd>


<dt id="arg-pattern-">pattern1<a class="anchor" aria-label="anchor" href="#arg-pattern-"></a></dt>
<dd><p>File names, portable names, regex matching either, or search names
selecting source for derived variables. See Image naming in
<a href="https://github.com/UMass-UAS-Salt-Marsh/marshmap/blob/main/README.md" class="external-link">README</a>
for details. See details.</p></dd>


<dt id="arg-pattern-">pattern2<a class="anchor" aria-label="anchor" href="#arg-pattern-"></a></dt>
<dd><p>A second pattern or vector of layer names, used for bivariate metrics. See details.</p></dd>


<dt id="arg-metrics">metrics<a class="anchor" aria-label="anchor" href="#arg-metrics"></a></dt>
<dd><p>A list of metrics to apply. Univariate metrics include:</p><dl><dt>NDVI</dt>
<dd><p>Normalized difference vegetation index, <code>(NIR - red) / (NIR + red)</code>, an index of biomass</p></dd>

<dt>NDWIg</dt>
<dd><p>Normalized difference water index (green, commonly known as McFeeter's <code>NDWI</code>),
<code>(green - NIR) / (green + NIR)</code>, primarily helps distinguish waterbodies</p></dd>

<dt>NDRE</dt>
<dd><p>Normalized difference red edge index, <code>(NIR - RE) / (NIR + RE)</code>, an index of the
amount of chlorophyll in a plant</p></dd>

<dt>mean</dt>
<dd><p>mean of each band in a window, size defined by <code>window</code></p></dd>

<dt>sd</dt>
<dd><p>standard deviation of each band in a window, size defined by <code>window</code></p></dd>

<dt>NDVImean</dt>
<dd><p>mean of NDVI in a window, size defined by <code>window</code></p></dd>

<dt>NDVIsd</dt>
<dd><p>standard deviation of NDVI in a window, size defined by <code>window</code></p></dd>

Bivariate metrics include:
<dt>NDWIswir</dt>
<dd><p>Normalized difference water index (SWIR, commonly known as Gao's <code>NDWI</code>),
<code>(NIR - SWIR) / (NIR + SWIR)</code>, an index of water content in leaves; requires a Mica layer for
<code>pattern1</code>, and a matched SWIR layer for <code>pattern2</code></p></dd>

<dt>delta</dt>
<dd><p>The difference between <code>pattern1</code> and <code>pattern2</code>, may be useful for taking a
difference between late-season and early-season DEMs to represent vegetation canopy height</p></dd>


</dl></dd>


<dt id="arg-window">window<a class="anchor" aria-label="anchor" href="#arg-window"></a></dt>
<dd><p>Window size for <code>mean</code>, <code>sd</code>, <code>NDVImean</code>, and <code>NDVIsd</code>, in cells; windows are square, so just specify
a single number. Bonus points if you remember to make it odd.</p></dd>


<dt id="arg-cache">cache<a class="anchor" aria-label="anchor" href="#arg-cache"></a></dt>
<dd><p>If TRUE, cache images for <code>screen</code>. If set to FALSE, these flights
will be blank in <code>screen</code>.</p></dd>


<dt id="arg-resources">resources<a class="anchor" aria-label="anchor" href="#arg-resources"></a></dt>
<dd><p>Slurm launch resources. See <a href="https://rdrr.io/pkg/slurmcollie/man/launch.html" class="external-link">launch</a>. These take priority
#'    over the function's defaults.</p></dd>


<dt id="arg-local">local<a class="anchor" aria-label="anchor" href="#arg-local"></a></dt>
<dd><p>If TRUE, run locally; otherwise, spawn a batch run on Unity</p></dd>


<dt id="arg-trap">trap<a class="anchor" aria-label="anchor" href="#arg-trap"></a></dt>
<dd><p>If TRUE, trap errors in local mode; if FALSE, use normal R error handling. Use this
for debugging. If you get unrecovered errors, the job won't be added to the jobs database. Has
no effect if local = FALSE.</p></dd>


<dt id="arg-comment">comment<a class="anchor" aria-label="anchor" href="#arg-comment"></a></dt>
<dd><p>Optional slurmcollie comment</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function creates any of a number of univariate and bivariate metrics derived from
raster data, such as NDVI and NDRE. Results are written as rasters to the <code>flights</code> directory,
with the metric included in the name. These metrics will be treated like source layers in
subsequent processing and modeling.</p>
<p>For univariate metrics, supply one or more layer names via <code>pattern1</code>. All metrics will be
calculated for each layer specified by <code>pattern1</code>. Results will be named <code>&lt;layer&gt;__&lt;metric&gt;</code>.</p>
<p>For bivariate metrics, specify matched pairs of layers with <code>pattern1</code> and <code>pattern2</code>. It's
best to specify complete names (you can use vectors for each) so the layers are paired properly.
If you're crazy enough to use regular expressions here, scrutinize the result names carefully.
Results will be named <code>&lt;layer1&gt;__&lt;layer2&gt;__metric</code>. At the moment, <code>NDWIswir</code> and <code>delta</code> are the
only bivariate metrics.</p>
<p>Note that all normalized difference (<code>NDxx</code>) metrics require five-band Mica data.</p>
<p>Note that derived metrics get two underscores in their names, e.g., <code>&lt;layer&gt;__NDVI</code>. This is
used to distinguish primary from derived data.</p>
<p>This fits in the workflow after <code>gather</code> and before <code>sample</code>.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Compton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

